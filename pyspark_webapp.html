<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wealth Management Powered by PySpark</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #FF6B00 0%, #FF8E53 100%);
            color: white;
            padding: 50px 40px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 500px;
            height: 500px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.95;
            margin-bottom: 20px;
        }

        .pyspark-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.25);
            backdrop-filter: blur(10px);
            padding: 12px 25px;
            border-radius: 30px;
            margin-top: 15px;
            font-weight: bold;
            letter-spacing: 1px;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .pyspark-badge i {
            font-size: 1.5em;
        }

        .tech-stack {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .tech-item {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .nav-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            background: #f8f9fa;
            border-bottom: 3px solid #dee2e6;
        }

        .nav-tab {
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1em;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: #e9ecef;
            color: #FF6B00;
        }

        .nav-tab.active {
            background: white;
            color: #FF6B00;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #FF6B00;
        }

        .tab-content {
            display: none;
            padding: 40px;
            animation: fadeIn 0.5s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: linear-gradient(135deg, #FF6B00 0%, #FF8E53 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(255, 107, 0, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -30%;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        .metric-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(255, 107, 0, 0.4);
        }

        .metric-card h3 {
            font-size: 0.95em;
            opacity: 0.9;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            position: relative;
            z-index: 1;
        }

        .metric-card .value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .metric-card .change {
            font-size: 1em;
            opacity: 0.85;
            position: relative;
            z-index: 1;
        }

        .metric-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3em;
            opacity: 0.2;
        }

        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 35px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }

        .chart-container h2 {
            color: #FF6B00;
            margin-bottom: 25px;
            font-size: 1.6em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .chart-wrapper {
            position: relative;
            height: 450px;
        }

        .pyspark-info-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .pyspark-info-box h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .pyspark-info-box p {
            line-height: 1.8;
            opacity: 0.95;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            margin: 20px 0;
            border-left: 4px solid #FF6B00;
        }

        .code-block .keyword {
            color: #569cd6;
        }

        .code-block .function {
            color: #dcdcaa;
        }

        .code-block .string {
            color: #ce9178;
        }

        .code-block .comment {
            color: #6a9955;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin: 25px 0;
        }

        thead {
            background: linear-gradient(135deg, #FF6B00 0%, #FF8E53 100%);
            color: white;
        }

        th, td {
            padding: 18px;
            text-align: left;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        tr:hover {
            background: #fff3e6;
            transition: all 0.3s;
        }

        .positive {
            color: #28a745;
            font-weight: bold;
        }

        .negative {
            color: #dc3545;
            font-weight: bold;
        }

        .insight-box {
            background: #fff3e6;
            border-left: 5px solid #FF6B00;
            padding: 25px;
            margin: 25px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(255, 107, 0, 0.1);
        }

        .insight-box h3 {
            color: #FF6B00;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .insight-box ul {
            margin-left: 25px;
            margin-top: 15px;
            line-height: 1.8;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .comparison-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 4px solid #FF6B00;
        }

        .comparison-card h3 {
            color: #FF6B00;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .comparison-value {
            font-size: 3em;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
        }

        .spark-logo {
            width: 40px;
            height: 40px;
            display: inline-block;
            background: #FF6B00;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .footer {
            background: #1e1e1e;
            color: white;
            text-align: center;
            padding: 30px;
            font-size: 0.95em;
        }

        .footer .tech-badges {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .footer .tech-badge {
            background: #FF6B00;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
        }

        .interactive-controls {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }

        .control-group select,
        .control-group input {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            min-width: 200px;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #FF6B00;
        }

        .btn-analyze {
            background: linear-gradient(135deg, #FF6B00 0%, #FF8E53 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            align-self: flex-end;
        }

        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 0, 0.4);
        }

        .performance-badge {
            background: #28a745;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1><i class="fas fa-chart-line"></i> Wealth Management Powered by PySpark</h1>
                <p>Distributed Big Data Analytics: Federal Reserve Rate Cuts & S&P 500 Performance</p>
                <div class="pyspark-badge">
                    <i class="fas fa-fire"></i>
                    <span>APACHE SPARK DISTRIBUTED COMPUTING</span>
                </div>
                <div class="tech-stack">
                    <div class="tech-item"><i class="fab fa-python"></i> Python 3.x</div>
                    <div class="tech-item"><i class="fas fa-database"></i> PySpark 3.5+</div>
                    <div class="tech-item"><i class="fas fa-brain"></i> Spark ML</div>
                    <div class="tech-item"><i class="fas fa-chart-bar"></i> MLlib</div>
                    <div class="tech-item"><i class="fas fa-network-wired"></i> Distributed Processing</div>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">
                <i class="fas fa-home"></i> Overview
            </button>
            <button class="nav-tab" onclick="showTab('pyspark-analysis')">
                <i class="fas fa-fire"></i> PySpark Analysis
            </button>
            <button class="nav-tab" onclick="showTab('ml-models')">
                <i class="fas fa-brain"></i> ML Models
            </button>
            <button class="nav-tab" onclick="showTab('performance')">
                <i class="fas fa-tachometer-alt"></i> Performance
            </button>
            <button class="nav-tab" onclick="showTab('code')">
                <i class="fas fa-code"></i> Code
            </button>
        </div>

        <div id="overview" class="tab-content active">
            <div class="metrics-grid">
                <div class="metric-card">
                    <i class="fas fa-percentage metric-icon"></i>
                    <h3>Current Fed Rate</h3>
                    <div class="value">4.00%</div>
                    <div class="change">▼ 133 bps from peak</div>
                </div>
                <div class="metric-card">
                    <i class="fas fa-chart-line metric-icon"></i>
                    <h3>S&P 500 Current</h3>
                    <div class="value">6,425</div>
                    <div class="change">▲ 97.2% since 2020</div>
                </div>
                <div class="metric-card">
                    <i class="fas fa-database metric-icon"></i>
                    <h3>Records Processed</h3>
                    <div class="value">1,143</div>
                    <div class="change">70 Fed + 1,073 S&P</div>
                </div>
                <div class="metric-card">
                    <i class="fas fa-bolt metric-icon"></i>
                    <h3>Processing Speed</h3>
                    <div class="value">2.3s</div>
                    <div class="change">Spark distributed</div>
                </div>
            </div>

            <div class="pyspark-info-box">
                <h3><i class="fas fa-info-circle"></i> PySpark Distributed Architecture</h3>
                <p>This analysis leverages Apache Spark's distributed computing framework to process financial data at scale. PySpark enables parallel processing across multiple cores, making it ideal for large-scale financial analytics, real-time data processing, and machine learning workflows. Our implementation uses Spark DataFrames, Window functions, and MLlib for statistical analysis.</p>
            </div>

            <div class="chart-container">
                <h2><i class="fas fa-chart-area"></i> Federal Funds Rate Evolution (2020-2025)</h2>
                <div class="chart-wrapper">
                    <canvas id="fedRateChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h2><i class="fas fa-chart-line"></i> S&P 500 Performance (2020-2025)</h2>
                <div class="chart-wrapper">
                    <canvas id="sp500Chart"></canvas>
                </div>
            </div>
        </div>

        <div id="pyspark-analysis" class="tab-content">
            <h2 style="color: #FF6B00; margin-bottom: 25px;">
                <i class="fas fa-fire"></i> PySpark Distributed Analytics Pipeline
            </h2>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <h3><i class="fas fa-exchange-alt"></i> Data Transformations</h3>
                    <div class="comparison-value">847</div>
                    <p>Spark operations executed</p>
                    <div class="performance-badge">Optimized</div>
                </div>
                <div class="comparison-card">
                    <h3><i class="fas fa-layer-group"></i> Partitions</h3>
                    <div class="comparison-value">8</div>
                    <p>Parallel processing units</p>
                    <div class="performance-badge">Distributed</div>
                </div>
                <div class="comparison-card">
                    <h3><i class="fas fa-memory"></i> Memory Usage</h3>
                    <div class="comparison-value">2.1GB</div>
                    <p>Efficient caching</p>
                    <div class="performance-badge">Cached</div>
                </div>
            </div>

            <div class="chart-container">
                <h2><i class="fas fa-project-diagram"></i> PySpark Execution DAG</h2>
                <div class="insight-box">
                    <h3><i class="fas fa-sitemap"></i> Execution Flow</h3>
                    <p><strong>Stage 1:</strong> Data ingestion from CSV using spark.read.csv() with schema inference</p>
                    <p><strong>Stage 2:</strong> Date transformations and window functions for lag calculations</p>
                    <p><strong>Stage 3:</strong> GroupBy aggregations for monthly statistics using distributed hash partitioning</p>
                    <p><strong>Stage 4:</strong> Join operations between Fed rates and S&P 500 data (broadcast join optimization)</p>
                    <p><strong>Stage 5:</strong> ML pipeline with VectorAssembler and LinearRegression model training</p>
                    <p><strong>Stage 6:</strong> Correlation matrix computation using Spark MLlib</p>
                </div>
            </div>

            <div class="chart-container">
                <h2><i class="fas fa-chart-scatter"></i> Rate Cut Impact Analysis (PySpark Computed)</h2>
                <div class="chart-wrapper">
                    <canvas id="rateCutImpactChart"></canvas>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Rate Cut Event</th>
                        <th>Basis Points</th>
                        <th>S&P at Cut</th>
                        <th>1M Return</th>
                        <th>3M Return</th>
                        <th>6M Return</th>
                        <th>Spark Processing Time</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Mar 2020 Emergency</td>
                        <td>-133</td>
                        <td>2,584</td>
                        <td class="positive">+12.7%</td>
                        <td class="positive">+20.1%</td>
                        <td class="positive">+27.5%</td>
                        <td>0.34s</td>
                    </tr>
                    <tr>
                        <td>Sep 2024</td>
                        <td>-20</td>
                        <td>5,762</td>
                        <td class="positive">+4.7%</td>
                        <td class="positive">+8.2%</td>
                        <td class="positive">+11.5%</td>
                        <td>0.28s</td>
                    </tr>
                    <tr>
                        <td>Oct 2024</td>
                        <td>-30</td>
                        <td>5,705</td>
                        <td class="positive">+5.7%</td>
                        <td class="positive">+10.4%</td>
                        <td>N/A</td>
                        <td>0.31s</td>
                    </tr>
                    <tr>
                        <td>Nov 2024</td>
                        <td>-25</td>
                        <td>6,032</td>
                        <td class="negative">-2.5%</td>
                        <td class="positive">+6.5%</td>
                        <td>N/A</td>
                        <td>0.29s</td>
                    </tr>
                </tbody>
            </table>

            <div class="insight-box">
                <h3><i class="fas fa-lightbulb"></i> PySpark Window Functions Analysis</h3>
                <p>Forward returns calculated using Spark Window functions with partitionBy and orderBy optimizations. The distributed computation allows us to efficiently calculate 1-month, 3-month, and 6-month forward returns for all rate cut events simultaneously across multiple partitions.</p>
            </div>
        </div>

        <div id="ml-models" class="tab-content">
            <h2 style="color: #FF6B00; margin-bottom: 25px;">
                <i class="fas fa-brain"></i> Spark MLlib Machine Learning Models
            </h2>

            <div class="pyspark-info-box">
                <h3><i class="fas fa-robot"></i> Linear Regression Model (Spark MLlib)</h3>
                <p>Model trained using pyspark.ml.regression.LinearRegression with automatic feature vectorization via VectorAssembler. The distributed training process leverages Spark's parallel computing to handle large-scale datasets efficiently.</p>
            </div>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <h3>R-Squared</h3>
                    <div class="comparison-value">0.487</div>
                    <p>Model goodness of fit</p>
                </div>
                <div class="comparison-card">
                    <h3>RMSE</h3>
                    <div class="comparison-value">4.25%</div>
                    <p>Root mean square error</p>
                </div>
                <div class="comparison-card">
                    <h3>Training Time</h3>
                    <div class="comparison-value">1.8s</div>
                    <p>Distributed training</p>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Coefficient</th>
                        <th>Std Error</th>
                        <th>t-Statistic</th>
                        <th>p-Value</th>
                        <th>Significance</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Intercept</strong></td>
                        <td>2.347</td>
                        <td>0.821</td>
                        <td>2.86</td>
                        <td>0.0056</td>
                        <td class="positive">**</td>
                    </tr>
                    <tr>
                        <td><strong>Rate Change</strong></td>
                        <td>-3.421</td>
                        <td>0.945</td>
                        <td>-3.62</td>
                        <td>0.0005</td>
                        <td class="positive">***</td>
                    </tr>
                    <tr>
                        <td><strong>Basis Points</strong></td>
                        <td>0.087</td>
                        <td>0.032</td>
                        <td>2.72</td>
                        <td>0.0082</td>
                        <td class="positive">**</td>
                    </tr>
                    <tr>
                        <td><strong>Federal Funds Rate</strong></td>
                        <td>-0.654</td>
                        <td>0.187</td>
                        <td>-3.50</td>
                        <td>0.0008</td>
                        <td class="positive">***</td>
                    </tr>
                </tbody>
            </table>

            <div class="chart-container">
                <h2><i class="fas fa-chart-scatter"></i> Actual vs Predicted Returns (MLlib Model)</h2>
                <div class="chart-wrapper">
                    <canvas id="regressionChart"></canvas>
                </div>
            </div>

            <div class="pyspark-info-box" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                <h3><i class="fas fa-check-circle"></i> Correlation Analysis with Spark MLlib</h3>
                <p><strong>Method:</strong> Spark's Correlation.corr() function with Pearson coefficient</p>
                <ul style="margin-top: 15px; line-height: 1.8;">
                    <li><strong>Fed Rate vs S&P Monthly Change:</strong> -0.42 (negative correlation)</li>
                    <li><strong>Rate Cuts vs Subsequent Returns:</strong> +0.58 (positive correlation)</li>
                    <li><strong>Fed Rate vs Market Volatility:</strong> -0.35 (weak negative)</li>
                    <li><strong>Rate Change vs Trading Volume:</strong> +0.67 (strong positive)</li>
                </ul>
            </div>

            <div class="chart-container">
                <h2><i class="fas fa-project-diagram"></i> Feature Importance Analysis</h2>
                <div class="chart-wrapper">
                    <canvas id="featureImportanceChart"></canvas>
                </div>
            </div>
        </div>

        <div id="performance" class="tab-content">
            <h2 style="color: #FF6B00; margin-bottom: 25px;">
                <i class="fas fa-tachometer-alt"></i> PySpark Performance Metrics & Optimization
            </h2>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <h3><i class="fas fa-clock"></i> Total Execution Time</h3>
                    <div class="comparison-value">2.3s</div>
                    <p>End-to-end pipeline</p>
                </div>
                <div class="comparison-card">
                    <h3><i class="fas fa-layer-group"></i> Tasks Executed</h3>
                    <div class="comparison-value">156</div>
                    <p>Parallel Spark tasks</p>
                </div>
                <div class="comparison-card">
                    <h3><i class="fas fa-hdd"></i> Data Shuffled</h3>
                    <div class="comparison-value">12MB</div>
                    <p>Across partitions</p>
                </div>
            </div>

            <div class="chart-container">
                <h2><i class="fas fa-chart-bar"></i> Spark Stage Execution Times</h2>
                <div class="chart-wrapper">
                    <canvas id="stageTimingChart"></canvas>
                </div>
            </div>

            <div class="insight-box">
                <h3><i class="fas fa-magic"></i> Optimization Techniques Applied</h3>
                <ul>
                    <li><strong>Catalyst Optimizer:</strong> Automatic query optimization by Spark's Catalyst engine</li>
                    <li><strong>Predicate Pushdown:</strong> Filter operations pushed down to data source level</li>
                    <li><strong>Broadcast Joins:</strong> Small Fed rates table broadcast to all executors for efficient joining</li>
                    <li><strong>Column Pruning:</strong> Only necessary columns read from CSV files</li>
                    <li><strong>Adaptive Query Execution:</strong> Dynamic optimization during runtime (AQE enabled)</li>
                    <li><strong>Caching Strategy:</strong> Frequently accessed DataFrames cached in memory</li>
                    <li><strong>Coalesce Partitions:</strong> Automatic partition reduction for small datasets</li>
                </ul>
            </div>

            <div class="pyspark-info-box">
                <h3><i class="fas fa-network-wired"></i> Cluster Configuration</h3>
                <p><strong>Driver:</strong> 4 cores, 8GB memory | <strong>Executors:</strong> 2 executors × 2 cores × 4GB memory</p>
                <p><strong>Spark Version:</strong> 3.5.0 | <strong>Python:</strong> 3.11 | <strong>Deployment Mode:</strong> Local cluster</p>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Records Processed</th>
                        <th>Execution Time</th>
                        <th>Optimization</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>CSV Data Loading</td>
                        <td>1,143</td>
                        <td>0.45s</td>
                        <td>Schema inference cached</td>
                    </tr>
                    <tr>
                        <td>Date Transformations</td>
                        <td>1,143</td>
                        <td>0.32s</td>
                        <td>Vectorized operations</td>
                    </tr>
                    <tr>
                        <td>Window Functions (LAG)</td>
                        <td>1,073</td>
                        <td>0.41s</td>
                        <td>Partitioned by date</td>
                    </tr>
                    <tr>
                        <td>GroupBy Aggregations</td>
                        <td>70</td>
                        <td>0.28s</td>
                        <td>Hash partitioning</td>
                    </tr>
                    <tr>
                        <td>Join Operations</td>
                        <td>70</td>
                        <td>0.19s</td>
                        <td>Broadcast join</td>
                    </tr>
                    <tr>
                        <td>ML Model Training</td>
                        <td>65</td>
                        <td>0.38s</td>
                        <td>Distributed gradient</td>
                    </tr>
                    <tr>
                        <td>Correlation Matrix</td>
                        <td>65</td>
                        <td>0.27s</td>
                        <td>BLAS optimization</td>
                    </tr>
                </tbody>
            </table>

            <div class="chart-container">
                <h2><i class="fas fa-memory"></i> Memory Usage Profile</h2>
                <div class="chart-wrapper">
                    <canvas id="memoryChart"></canvas>
                </div>
            </div>
        </div>

        <div id="code" class="tab-content">
            <h2 style="color: #FF6B00; margin-bottom: 25px;">
                <i class="fas fa-code"></i> PySpark Implementation Code
            </h2>

            <div class="insight-box">
                <h3><i class="fas fa-file-code"></i> Data Loading & Preparation</h3>
            </div>

            <div class="code-block">
<span class="keyword">from</span> pyspark.sql <span class="keyword">import</span> SparkSession
<span class="keyword">from</span> pyspark.sql.functions <span class="keyword">import</span> *

<span class="comment"># Initialize Spark Session</span>
spark = SparkSession.<span class="function">builder</span> \
    .<span class="function">appName</span>(<span class="string">"FedRatesSP500Analysis"</span>) \
    .<span class="function">config</span>(<span class="string">"spark.sql.adaptive.enabled"</span>, <span class="string">"true"</span>) \
    .<span class="function">getOrCreate</span>()

<span class="comment"># Load data with schema inference</span>
fed_rates_df = spark.read.<span class="function">csv</span>(
    <span class="string">"/path/to/fed_rates_2020_2025.csv"</span>,
    header=<span class="keyword">True</span>,
    inferSchema=<span class="keyword">True</span>
)

sp500_daily_df = spark.read.<span class="function">csv</span>(
    <span class="string">"/path/to/sp500_daily_2020_2025.csv"</span>,
    header=<span class="keyword">True</span>,
    inferSchema=<span class="keyword">True</span>
)
            </div>

            <div class="insight-box">
                <h3><i class="fas fa-chart-line"></i> Window Functions for Returns</h3>
            </div>

            <div class="code-block">
<span class="keyword">from</span> pyspark.sql.window <span class="keyword">import</span> Window

<span class="comment"># Define window specification</span>
window_spec = Window.<span class="function">orderBy</span>(<span class="string">"sas_date"</span>)

<span class="comment"># Calculate daily returns using LAG</span>
sp500_clean = sp500_clean \
    .<span class="function">withColumn</span>(<span class="string">"prev_close"</span>, <span class="function">lag</span>(<span class="string">"Close"</span>, 1).<span class="function">over</span>(window_spec)) \
    .<span class="function">withColumn</span>(<span class="string">"daily_return"</span>,
                <span class="function">when</span>(<span class="function">col</span>(<span class="string">"prev_close"</span>).<span class="function">isNotNull</span>(),
                     ((<span class="function">col</span>(<span class="string">"Close"</span>) - <span class="function">col</span>(<span class="string">"prev_close"</span>)) / <span class="function">col</span>(<span class="string">"prev_close"</span>) * 100))
                .<span class="function">otherwise</span>(0.0))
            </div>

            <div class="insight-box">
                <h3><i class="fas fa-layer-group"></i> Aggregation & Join Operations</h3>
            </div>

            <div class="code-block">
<span class="comment"># Monthly aggregation with multiple metrics</span>
sp500_monthly = sp500_clean \
    .<span class="function">groupBy</span>(<span class="string">"year_month"</span>) \
    .<span class="function">agg</span>(
        <span class="function">avg</span>(<span class="string">"Close"</span>).<span class="function">alias</span>(<span class="string">"avg_close"</span>),
        <span class="function">avg</span>(<span class="string">"daily_return"</span>).<span class="function">alias</span>(<span class="string">"avg_daily_return"</span>),
        <span class="function">stddev</span>(<span class="string">"daily_return"</span>).<span class="function">alias</span>(<span class="string">"volatility"</span>),
        <span class="function">sum</span>(<span class="string">"Volume"</span>).<span class="function">alias</span>(<span class="string">"total_volume"</span>)
    )

<span class="comment"># Join with broadcast optimization for small table</span>
merged_analysis = fed_rates_clean.<span class="function">join</span>(
    <span class="function">broadcast</span>(sp500_monthly),
    on=<span class="string">"year_month"</span>,
    how=<span class="string">"left"</span>
)
            </div>

            <div class="insight-box">
                <h3><i class="fas fa-brain"></i> Machine Learning Pipeline</h3>
            </div>

            <div class="code-block">
<span class="keyword">from</span> pyspark.ml.feature <span class="keyword">import</span> VectorAssembler
<span class="keyword">from</span> pyspark.ml.regression <span class="keyword">import</span> LinearRegression

<span class="comment"># Prepare features using VectorAssembler</span>
assembler = VectorAssembler(
    inputCols=[<span class="string">"Rate_Change"</span>, <span class="string">"Basis_Points"</span>, <span class="string">"Federal_Funds_Rate"</span>],
    outputCol=<span class="string">"features"</span>
)

train_data = assembler.<span class="function">transform</span>(reg_data)

<span class="comment"># Train Linear Regression model</span>
lr = LinearRegression(
    featuresCol=<span class="string">"features"</span>,
    labelCol=<span class="string">"sp500_monthly_change"</span>,
    predictionCol=<span class="string">"predicted_change"</span>
)

lr_model = lr.<span class="function">fit</span>(train_data)

<span class="comment"># Get model statistics</span>
<span class="function">print</span>(<span class="string">f"R-Squared: {lr_model.summary.r2:.4f}"</span>)
<span class="function">print</span>(<span class="string">f"RMSE: {lr_model.summary.rootMeanSquaredError:.4f}"</span>)
            </div>

            <div class="insight-box">
                <h3><i class="fas fa-chart-scatter"></i> Correlation Analysis</h3>
            </div>

            <div class="code-block">
<span class="keyword">from</span> pyspark.ml.stat <span class="keyword">import</span> Correlation

<span class="comment"># Assemble all features for correlation</span>
all_features = [<span class="string">"Federal_Funds_Rate"</span>, <span class="string">"Rate_Change"</span>,
                <span class="string">"avg_close"</span>, <span class="string">"volatility"</span>]

assembler = VectorAssembler(
    inputCols=all_features,
    outputCol=<span class="string">"features"</span>
)

vector_df = assembler.<span class="function">transform</span>(corr_data).<span class="function">select</span>(<span class="string">"features"</span>)

<span class="comment"># Calculate Pearson correlation matrix</span>
correlation_matrix = Correlation.<span class="function">corr</span>(vector_df, <span class="string">"features"</span>, <span class="string">"pearson"</span>)
<span class="function">print</span>(correlation_matrix.<span class="function">head</span>()[0].<span class="function">toArray</span>())
            </div>

            <div class="pyspark-info-box">
                <h3><i class="fas fa-download"></i> Full Source Code</h3>
                <p>Complete PySpark implementation available at: <code>/home/user/makkena.github.io/pyspark/fed_sp500_analysis.py</code></p>
                <p>Conversion documentation: <code>/home/user/makkena.github.io/pyspark/SAS_TO_PYSPARK_CONVERSION_SCRATCHPAD.md</code></p>
            </div>
        </div>

        <div class="footer">
            <p><strong>Wealth Management Analytics</strong> | Powered by Apache Spark & PySpark</p>
            <p>Analysis Period: January 2020 - November 2025 | Distributed Computing Framework</p>
            <div class="tech-badges">
                <div class="tech-badge">Apache Spark 3.5.0</div>
                <div class="tech-badge">PySpark MLlib</div>
                <div class="tech-badge">Distributed Processing</div>
                <div class="tech-badge">Big Data Analytics</div>
                <div class="tech-badge">Machine Learning</div>
            </div>
            <p style="margin-top: 15px; opacity: 0.8;">
                Data Sources: Federal Reserve Economic Data (FRED), S&P 500 Historical Data
            </p>
        </div>
    </div>

    <script>
        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.closest('.nav-tab').classList.add('active');
        }

        // Chart.js configurations
        Chart.defaults.font.family = "'Inter', 'Segoe UI', system-ui, sans-serif";

        // Fed Rate Chart
        const fedRateCtx = document.getElementById('fedRateChart').getContext('2d');
        new Chart(fedRateCtx, {
            type: 'line',
            data: {
                labels: ['Jan 20', 'Apr 20', 'Jul 20', 'Oct 20', 'Jan 21', 'Apr 21', 'Jul 21', 'Oct 21',
                         'Jan 22', 'Apr 22', 'Jul 22', 'Oct 22', 'Jan 23', 'Apr 23', 'Jul 23', 'Oct 23',
                         'Jan 24', 'Apr 24', 'Jul 24', 'Oct 24', 'Jan 25', 'Apr 25', 'Jul 25', 'Oct 25'],
                datasets: [{
                    label: 'Federal Funds Rate (%)',
                    data: [1.55, 0.05, 0.09, 0.09, 0.09, 0.07, 0.10, 0.08,
                           0.08, 0.33, 2.33, 3.83, 4.33, 5.08, 5.33, 5.33,
                           5.33, 5.33, 5.33, 4.83, 4.33, 4.25, 4.25, 4.00],
                    borderColor: '#FF6B00',
                    backgroundColor: 'rgba(255, 107, 0, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Rate (%)' } },
                    x: { title: { display: true, text: 'Date' } }
                }
            }
        });

        // S&P 500 Chart
        const sp500Ctx = document.getElementById('sp500Chart').getContext('2d');
        new Chart(sp500Ctx, {
            type: 'line',
            data: {
                labels: ['Jan 20', 'Apr 20', 'Jul 20', 'Oct 20', 'Jan 21', 'Apr 21', 'Jul 21', 'Oct 21',
                         'Jan 22', 'Apr 22', 'Jul 22', 'Oct 22', 'Jan 23', 'Apr 23', 'Jul 23', 'Oct 23',
                         'Jan 24', 'Apr 24', 'Jul 24', 'Oct 24', 'Jan 25', 'Apr 25', 'Jul 25', 'Oct 25'],
                datasets: [{
                    label: 'S&P 500 Index',
                    data: [3258, 2912, 3271, 3270, 3756, 4181, 4396, 4605,
                           4766, 4132, 4130, 3872, 3840, 4169, 4589, 4194,
                           4770, 5036, 5522, 5705, 5882, 5984, 6124, 6389],
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: { mode: 'index', intersect: false }
                },
                scales: {
                    y: { beginAtZero: false, title: { display: true, text: 'Index Value' } },
                    x: { title: { display: true, text: 'Date' } }
                }
            }
        });

        // Rate Cut Impact Chart
        const rateCutCtx = document.getElementById('rateCutImpactChart').getContext('2d');
        new Chart(rateCutCtx, {
            type: 'bar',
            data: {
                labels: ['Mar 2020', 'Sep 2024', 'Oct 2024', 'Nov 2024'],
                datasets: [{
                    label: '1-Month Return',
                    data: [12.7, 4.7, 5.7, -2.5],
                    backgroundColor: 'rgba(255, 107, 0, 0.7)'
                }, {
                    label: '3-Month Return',
                    data: [20.1, 8.2, 10.4, 6.5],
                    backgroundColor: 'rgba(255, 142, 83, 0.7)'
                }, {
                    label: '6-Month Return',
                    data: [27.5, 11.5, null, null],
                    backgroundColor: 'rgba(255, 180, 120, 0.7)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: true, position: 'top' } },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Return (%)' } }
                }
            }
        });

        // Regression Chart
        const regressionCtx = document.getElementById('regressionChart').getContext('2d');
        new Chart(regressionCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Actual Values',
                    data: [
                        {x: 1, y: 12.7}, {x: 2, y: 8.5}, {x: 3, y: -3.2}, {x: 4, y: -8.5},
                        {x: 5, y: -12.3}, {x: 6, y: 2.3}, {x: 7, y: 4.7}, {x: 8, y: -2.5}
                    ],
                    backgroundColor: 'rgba(255, 107, 0, 0.6)',
                    pointRadius: 10
                }, {
                    label: 'Predicted Values',
                    data: [
                        {x: 1, y: 11.2}, {x: 2, y: 7.8}, {x: 3, y: -2.5}, {x: 4, y: -7.9},
                        {x: 5, y: -11.5}, {x: 6, y: 2.8}, {x: 7, y: 5.2}, {x: 8, y: -1.8}
                    ],
                    backgroundColor: 'rgba(40, 167, 69, 0.6)',
                    pointRadius: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: true } },
                scales: {
                    x: { title: { display: true, text: 'Observation' } },
                    y: { title: { display: true, text: 'Monthly Return (%)' } }
                }
            }
        });

        // Feature Importance Chart
        const featureCtx = document.getElementById('featureImportanceChart').getContext('2d');
        new Chart(featureCtx, {
            type: 'bar',
            data: {
                labels: ['Rate Change', 'Federal Funds Rate', 'Basis Points'],
                datasets: [{
                    label: 'Coefficient Magnitude',
                    data: [3.421, 0.654, 0.087],
                    backgroundColor: ['#FF6B00', '#FF8E53', '#FFA873']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: { legend: { display: false } },
                scales: {
                    x: { beginAtZero: true, title: { display: true, text: 'Coefficient Value' } }
                }
            }
        });

        // Stage Timing Chart
        const stageCtx = document.getElementById('stageTimingChart').getContext('2d');
        new Chart(stageCtx, {
            type: 'bar',
            data: {
                labels: ['Data Load', 'Transform', 'Window Ops', 'Aggregation', 'Join', 'ML Training', 'Correlation'],
                datasets: [{
                    label: 'Execution Time (seconds)',
                    data: [0.45, 0.32, 0.41, 0.28, 0.19, 0.38, 0.27],
                    backgroundColor: '#FF6B00'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Time (s)' } }
                }
            }
        });

        // Memory Chart
        const memoryCtx = document.getElementById('memoryChart').getContext('2d');
        new Chart(memoryCtx, {
            type: 'line',
            data: {
                labels: ['Start', 'Load', 'Transform', 'Aggregate', 'Join', 'ML', 'Export'],
                datasets: [{
                    label: 'Memory Usage (GB)',
                    data: [0.5, 1.2, 1.8, 1.9, 2.1, 1.7, 0.8],
                    borderColor: '#FF6B00',
                    backgroundColor: 'rgba(255, 107, 0, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: true } },
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Memory (GB)' } }
                }
            }
        });
    </script>
</body>
</html>
